<?php/*  Template Name: Merchant Registration Template */?><!doctype html><html class="no-js" lang="en-US" xmlns:fb="http://ogp.me/ns/fb#" xmlns:addthis="http://www.addthis.com/help/api-spec"  prefix="og: http://ogp.me/ns#"><?phpglobal $MM_EMAILTEMPLATES,$MerchantObject, $theme_settings, $post, $MMGlobalFunctions, $MMWooFunctions;wp_head();?><body class="page page-id-225 page-template-default merchant-dashboard sidebar-primary" style=""><?php$site_logo = "";if(!empty($theme_settings)) {    $site_logo = str_replace('http://', 'http://', $theme_settings['site_logo']);}$success = '';if (isset($_POST['submit'])) {    $user_login         = $_POST["user_login"];	    $user_email		= $_POST["user_email"];    $user_first 	= $_POST["first_name"];    $user_last	 	= $_POST["last_name"];    $user_phone	 	= $_POST["user_phone"];    $user_shop          = $_POST["user_shop"];    $user_pass		= $_POST["user_pass"];    $pass_confirm 	= $_POST["user_pass_confirm"];    if(isset($_POST['Merchant_id']) && !empty($_GET['merchant_id'])){        $merchant_user_id = $_POST['Merchant_id'];        $user_info = get_userdata($merchant_user_id);        require_once(ABSPATH . WPINC . '/registration.php');        if($user_info->user_email != $user_email){            if(!is_email($user_email)) {                pippin_errors()->add('email_invalid', __('Invalid email'));            }            if(email_exists($user_email)) {                pippin_errors()->add('email_used', __('Email already registered'));            }            $errors = pippin_errors()->get_error_messages();              if(empty($errors)) {                $new_user_id = wp_update_user(array(                        'ID'		=> $merchant_user_id,                        'user_email'	=> $user_email,                    )                );                update_user_meta($new_user_id, 'activation_key',  rand());                if($new_user_id) {                    $referer_link = site_url();                    $MM_EMAILTEMPLATES->on_user_editreg_to_user_et($new_user_id, $referer_link);                    $MM_EMAILTEMPLATES->on_user_editreg_to_admin_et($user_first, $user_last, $user_email);                        $success = '<i class="ion ion-checkmark"></i> You are successfully Changed Email. Please check your email for confirmation link !!';                }            }        }        if($user_pass !="" && $pass_confirm !=""){            if($user_pass != $pass_confirm) {                pippin_errors()->add('password_mismatch', __('Passwords do not match'));            }            $errors = pippin_errors()->get_error_messages();                if(empty($errors)) {                    $new_user_id = wp_update_user(array(                        'ID'		=> $merchant_user_id,                        'user_pass'	=> $user_pass,                        )                    );                }        }        if($user_login == '') {            pippin_errors()->add('username_empty', __('Please enter a username'));        }        $errors = pippin_errors()->get_error_messages();        if(empty($errors)) {            $new_user_id = wp_update_user(array(                        'ID'		=> $merchant_user_id,                        'user_login'	=> $user_login,                        'first_name'	=> $user_first,                        'last_name'	=> $user_last,                    )            );            update_usermeta($new_user_id, 'user_phone', $user_phone);             update_usermeta($new_user_id, 'user_shop', $user_shop);         }    } else{         require_once(ABSPATH . WPINC . '/registration.php');    require_once( ABSPATH . 'wp-admin/includes/image.php' );    require_once( ABSPATH . 'wp-admin/includes/file.php' );    require_once( ABSPATH . 'wp-admin/includes/media.php' );    $upload_pan_vat_tan = media_handle_upload( 'upload_pan_vat_tan', $_POST['upload_pan_vat_tan'] );    $upload_address_proof = media_handle_upload( 'upload_address_proof', $_POST['upload_address_proof'] );    $upload_id_proof = media_handle_upload( 'upload_id_proof', $_POST['upload_id_proof'] );    $upload_cheque = media_handle_upload( 'upload_cheque', $_POST['upload_cheque'] );     $upload_scancopy = media_handle_upload( 'upload_scancopy', $_POST['upload_scancopy'] );     if(username_exists($user_login)) {                // Username already registered         pippin_errors()->add('username_unavailable', __('Username already taken'));        }        if(!validate_username($user_login)) {                // invalid username                pippin_errors()->add('username_invalid', __('Invalid username'));        }        if($user_login == '') {                // empty username                pippin_errors()->add('username_empty', __('Please enter a username'));        }        if(!is_email($user_email)) {                //invalid email                pippin_errors()->add('email_invalid', __('Invalid email'));        }        if(email_exists($user_email)) {                //Email address already registered                pippin_errors()->add('email_used', __('Email already registered'));        }        if($user_pass == '') {                // passwords do not match                pippin_errors()->add('password_empty', __('Please enter a password'));        }        if($user_pass != $pass_confirm) {                // passwords do not match                pippin_errors()->add('password_mismatch', __('Passwords do not match'));        }        $errors = pippin_errors()->get_error_messages();        if(empty($errors)) {        $new_user_id = wp_insert_user(array(                        'user_login'		=> $user_login,                        'user_pass'	 	=> $user_pass,                        'user_email'		=> $user_email,                        'first_name'		=> $user_first,                        'last_name'		=> $user_last,                        'user_registered'	=> date('Y-m-d H:i:s'),                        'role'			=> 'merchant'                )        );        update_usermeta($new_user_id, 'user_phone', $user_phone);        update_usermeta($new_user_id, 'user_shop', $user_shop);        update_usermeta($new_user_id, 'user_pan_vat_tan', $upload_pan_vat_tan);        update_usermeta($new_user_id, 'user_address_proof', $upload_address_proof);        update_usermeta($new_user_id, 'user_id_proof', $upload_id_proof);        update_usermeta($new_user_id, 'user_cheque', $upload_cheque);        update_usermeta($new_user_id, 'user_scancopy', $upload_scancopy);        update_user_meta($new_user_id, 'activation_key',  rand());        update_user_meta($new_user_id, 'user_verified',  'non-verified');        if($new_user_id) {        $referer_link = site_url();        $MM_EMAILTEMPLATES->on_user_reg_to_user_et($new_user_id, $referer_link);        $MM_EMAILTEMPLATES->on_user_reg_to_admin_et($user_first, $user_last, $user_email);            //wp_new_user_notification($new_user_id);        $success = '<i class="ion ion-checkmark"></i> You\'re successfully register. Please check your email for confirmation link !!';        }    }    }   }?><div  id="wrapper" class="wrap"  role="document"><div class="mask"></div><div id="page-content-wrapper">    <div class="container-fluid">        <div class="content row">            <div class="container main-container">            <header class="banner navbar navbar-default navbar-static-top " role="banner" <?php echo $header_image; ?>>                <div class="header_cols" style="padding-top:10px; padding-bottom:10px; ">                  <div class="container">                      <div class="col-sm-4 col-xs-4 col-md-4 col-lg-4">                        <div class="header_col_1">                            <a class="site_logo" href="<?php echo home_url(); ?>/">                            <?php if( $site_logo == "" ) { ?>                              <?php bloginfo('name'); ?>                              <?php } else { ?>                              <img src="<?php echo $site_logo; ?>" alt="<?php bloginfo('name'); ?>"  />                                    <?php } ?>                            </a>                      </div>                          </div>                    <div class="col-sm-8 col-xs-8 col-md-8 col-lg-8 dashboard_merchant_account_menu">                      <?php do_action('merchant_account_menu'); ?>                    </div>                      <?php                       if(is_page( 'merchant-registration' ) && !is_user_logged_in ()){ ?>                     <div class="login-merchant"> <i class="fa fa-sign-in"></i><a href="<?php echo site_url();?>/merchant-dashboard">Merchant Login</a></div>                     <?php } ?>                    <div class="clear"></div>                  </div>                </div>            </header>            <main class="main" role="main">            <?php        if(isset($_GET['merchant_id']) && !empty($_GET['merchant_id'])) {            if(is_user_logged_in()) {            $merchant_user = wp_get_current_user(); ?>          <div id="merchant_registration">            <div class="registration_container">            <div class="container registration_container_info">            <h2 class="page-header"><i class="ion ion-compose"></i>Edit Profile</h2>              <?php show_error_messages();              if( ! empty( $success ) ){                    echo '<span class="col-sm-12"><span class="success">'. $success .'</span></span>';                }?>                <form name="registerform" action="#" method="post" >                    <div class="form-group col-sm-6">                        <label for="user_login" class='label_input'>Username<span class="required"> * </span>:</label>                        <div class='label_input'><input type="text" name="user_login" value="<?php echo $merchant_user->user_login; ?>" class="form-control"></div>                    </div>                    <input type="hidden" name="role" id="role" value="merchant" >                    <div class="form-group col-sm-6">                        <label for="first_name" class='label_input'>First Name<span class="required"> * </span>:</label>                        <div class='label_input'><input type="text" name="first_name" value="<?php echo $merchant_user->first_name; ?>" class="form-control"></div>                    </div>                    <div class="form-group col-sm-6">                        <label for="last_name" class='label_input'>Last Name<span class="required"> * </span>:</label>                        <div class='label_input'><input type="text" name="last_name" value="<?php echo $merchant_user->last_name; ?>" class="form-control"></div>                    </div>                    <div class="form-group col-sm-6">                        <label for="user_email" class='label_input'>E-mail<span class="required"> * </span>:</label>                        <div class='label_input'><input type="text" name="user_email" id="user_email" value="<?php echo $merchant_user->user_email; ?>" class="form-control"></div>                    </div>                    <div class="form-group col-sm-6" >                        <label for="user_phone" class='label_input'>Phone<span class="required"> * </span>:</label>                        <div class='label_input'><input type="text" name="user_phone" id="user_phone" value="<?php echo esc_attr( get_the_author_meta( 'user_phone', $merchant_user->ID ) ); ?>" class="form-control"></div>                    </div>                    <div class="form-group col-sm-6" >                        <label for="user_shop" class='label_input'>Shop Name :</label>                        <div class='label_input'><input type="text" name="user_shop" id="user_shop" value="<?php echo esc_attr( get_the_author_meta( 'user_shop', $merchant_user->ID ) ); ?>" class="form-control"></div>                    </div>                    <div class="form-group col-sm-6" >                      <label for="user_pass" class='label_input'>Change New Password<span class="required"> * </span>:</label>                      <div class='label_input'><input type="password" name="user_pass" id="user_pass" value="" class="form-control"></div>                    </div>                    <div class="form-group col-sm-6">                      <label for="user_pass_confirm" class='label_input'>Change New Password Again<span class="required"> * </span>:</label>                      <div class='label_input'><input type="password" name="user_pass_confirm" id="user_pass_confirm" value="" class="form-control"></div>                    </div>                    <input type="hidden" name="Merchant_id" value="<?php echo $merchant_user->ID; ?>" />                    <div class="form-group col-sm-12 mer-btn">                        <input type="submit" name="submit" id="submit" value="Update" class="form-control" />                    </div>                </form>            </div>            </div>        </div>	        <?php }            } else { ?>                  <div id="merchant_registration">          <div class="registration_container">          <div class="container registration_container_info">            <h2 class="page-header"><i class="ion ion-compose"></i>Registration</h2>            <?php show_error_messages();            if( ! empty( $success ) ){              echo '<span class="col-sm-12"><span class="success">'. $success .'</span></span>';            }?>            <form name="registerform" action="#" method="post" enctype="multipart/form-data">                <div class="form-group col-sm-6">                    <label for="user_login" class='label_input'>Username<span class="required"> * </span>:</label>                    <div class='label_input'><input type="text" name="user_login" value="" class="form-control"></div>                </div>                <input type="hidden" name="role" id="role" value="merchant" >                <div class="form-group col-sm-6">                    <label for="first_name" class='label_input'>First Name<span class="required"> * </span>:</label>                    <div class='label_input'><input type="text" name="first_name" value="" class="form-control"></div>                </div>                <div class="form-group col-sm-6">                    <label for="last_name" class='label_input'>Last Name<span class="required"> * </span>:</label>                    <div class='label_input'><input type="text" name="last_name" value="" class="form-control"></div>                </div>                <div class="form-group col-sm-6">                    <label for="user_email" class='label_input'>E-mail<span class="required"> * </span>:</label>                    <div class='label_input'><input type="text" name="user_email" id="user_email" value="" class="form-control"></div>                </div>                <div class="form-group col-sm-6" >                    <label for="user_phone" class='label_input'>Phone<span class="required"> * </span>:</label>                    <div class='label_input'><input type="text" name="user_phone" id="user_phone" value="" class="form-control"></div>                </div>                <div class="form-group col-sm-6" >                    <label for="user_shop" class='label_input'>Shop Name :</label>                    <div class='label_input'><input type="text" name="user_shop" id="user_shop" value="" class="form-control"></div>                </div>                <div class="form-group col-sm-6" >                    <label for="user_pass" class='label_input'>Password<span class="required"> * </span>:</label>                    <div class='label_input'><input type="password" name="user_pass" id="user_pass" value="" class="form-control"></div>                </div>                <div class="form-group col-sm-6">                    <label for="user_pass_confirm" class='label_input'>Password Again<span class="required"> * </span>:</label>                    <div class='label_input'><input type="password" name="user_pass_confirm" id="user_pass_confirm" value="" class="form-control"></div>                </div>                <div class="form-group col-sm-12" >                    <div class="form-group col-sm-3 col-xs-12 mer-choose-file">                      <div class='label_input'>                          <label for="upload_pan_vat_tan" class='label_input'>Upload PAN VAT TAN</label>                          <input type="file" name="upload_pan_vat_tan" id="upload_pan_vat_tan"  class="upload_pan_vat_tan" />                          <?php wp_nonce_field( 'upload_pan_vat_tan', 'upload_pan_vat_tan_nonce' ); ?>                      </div>                    </div>                    <div class="form-group col-sm-3 col-xs-12 mer-choose-file">                        <div class='label_input'>                            <label for="upload_address_proof" class='label_input'>Upload Address proof</label>                            <input type="file" name="upload_address_proof" id="upload_address_proof"   class="upload_address_proof" />                           <?php wp_nonce_field( 'upload_address_proof', 'upload_address_proof_nonce' ); ?>                        </div>                    </div>                    <div class="form-group col-sm-3 col-xs-12 mer-choose-file">                        <div class='label_input'>                            <label for="upload_id_proof" class='label_input'>Upload ID Proof</label>                            <input type="file" name="upload_id_proof" id="upload_id_proof"   class="upload_id_proof" />                           <?php wp_nonce_field( 'upload_id_proof', 'upload_id_proof_nonce' ); ?>                        </div>                    </div>                    <div class="form-group col-sm-3 col-xs-12 mer-choose-file">                        <div class='label_input'>                            <label for="upload_cheque" class='label_input'>Upload Cancelled cheque</label>                            <input type="file" name="upload_cheque" id="upload_cheque"   class="upload_cheque" />                            <?php wp_nonce_field( 'upload_cheque', 'upload_cheque_nonce' ); ?>                        </div>                    </div>                    <div class="form-group col-sm-3 col-xs-12 mer-choose-file">                        <div class='label_input'>                            <label for="upload_scancopy" class='label_input'>Upload Scan Copy</label>                            <input type="file" name="upload_scancopy" id="upload_scancopy"   class="upload_scancopy" />                            <?php wp_nonce_field( 'upload_scancopy', 'upload_scancopy_nonce' ); ?>                        </div>                    </div>                </div>                  <!--<input type="hidden" name="redirect_to" value="/login/?action=register&success=1" />-->                <div class="form-group col-sm-12 mer-btn">                    <input type="submit" name="submit" id="submit" value="Register" class="form-control" />                </div>            </form>        </div>        </div>        </div>        <?php }        function show_error_messages() {            if ($codes = pippin_errors()->get_error_codes()) {                echo '<div class="pippin_errors">';                // Loop error codes and display errors                foreach ($codes as $code) {                    $message = pippin_errors()->get_error_message($code);                    echo '<span class="error col-sm-3 col-xs-12"><span class="error-inner"><strong>' . __('Error') . '</strong>: ' . $message . '</span></span>';                }                echo '</div>';            }        }        function pippin_errors() {          static $wp_error; // Will hold global variable safely          return isset($wp_error) ? $wp_error : ($wp_error = new WP_Error(null, null, null));        }?>    </main>    <!--footer-->    </div><!-- /.content -->    </div><!-- /.container -->    </div><!-- /.wrap -->    </div></div><?php wp_footer(); ?></body></html>