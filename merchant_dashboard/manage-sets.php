<?php/*** Mnange Products sets Template*/class ManageSetList {         public function __construct() {       add_action('wp_footer', array($this, 'manage_product_sets_template'));       add_action('wp_ajax_add_merchant_set_products', array($this, 'add_merchant_set_products_ajax'));       add_action('wp_ajax_create_set_product_call', array($this, 'create_set_product_call_ajax'));       add_action('wp_ajax_created_set_details_call', array($this, 'created_set_details_call_ajax'));       add_action('wp_ajax_edited_set_details_call', array($this, 'edited_set_details_call_ajax'));       add_action('wp_ajax_edit_set_product_call', array($this, 'edit_set_product_call_ajax'));       add_action('wp_ajax_delete_set_product', array($this, 'delete_set_product_call_ajax'));    }    //Product Upload Template    public function manage_product_sets_template() {        ob_start(); ?>        <script type="text/html" id="manage_sets_tml">        <?php        if(is_user_logged_in()) {        $merchant_user = wp_get_current_user();//        print_r($merchant_user->ID);        if($merchant_user->roles[0] == 'merchant') {        ?>        <div class="product_set_container">            <div class="container" style="">                <h2 class="page-header"><i class="icon ion-gear-a"></i>Manage Sets</h2>                <div class="alert alert-success error_success_messages" role="alert">                  <ul></ul>                </div>                <div class="alert alert-danger error_success_messages" role="alert">                  <ul></ul>                </div>                <div class="row">                    <div class="col-sm-4" id="merchant_products_sets">                            <div class="inner_wrap" style="background: #f2f2f2;color: #111;padding: 15px;">                            <input type="checkbox" name="created_set_details" class="created_set_details" value="yes"  style="margin-right:5px; vertical-align: sub;"><label style="font-size:12px;" for="yes">Product Set List</label><i class="fa fa-cog fa-spin catfilterloader" style="color: #eb0d7d; margin-left: 5px; display: none;"></i>                            <div class="product_set_inner"></div>                            </div>                        <div class="form-group col-sm-12">                                <div id="products_set_list_edit" >                                                                                    </div>                        </div>                    </div>                    <div id="products_sets_list_view" class="col-sm-8">                        <div class="container" style="">                        <h3 class="page-header"><i class="icon ion-compose"></i>Create New Set</h3>                        </div>                        <form action="" method="post" class="create_product_set_from">                            <div class="form-group col-sm-12">                                   <input type="hidden" name="user_id" value="<?php echo $merchant_user->ID; ?>">                                <label for="product_title" class='label_input'>Product Set Name<span class="required"></span>:</label>                                <div class='label_input'><input type="text" class="form-control" name="set_name" id="set_name" value="" /></div>                                <div class="clearfix"></div>                            </div>                            <div class="form-group col-sm-6 col-xs-12">                                <label for="select_product_set" class='label_input'>Select Products:<span class="required"> * </span>:</label>                                <div class='label_input'>                                <?php                                $args = array( 'post_type' => 'product', 'posts_per_page' => -1,'post_status' =>'publish','author' => $merchant_user->ID );                                $posts_array = get_posts( $args );//                                                               if ( $posts_array ) {//                                $myterms = get_terms('metal', array('hide_empty'=>false));                                    echo "<select class='form-control' name='select_product_set' id='select_product_set'>";                                    echo "<option value=''>Please Select Product</option>";                                    foreach($posts_array as $product){                                        $term_slug=$product->ID;                                        $term_name =$product->post_title ;                                        echo "<option value='".$term_slug."'>".$term_name."</option>";                                    }                                echo "</select>";                                  }?>                                   <!--<input type="text" class="form-control" name="product_metal" id="product_metal" value="" />--></div>                                <div class="clearfix"></div>                            </div>                            <div class="form-group">                                <div class="select_product_for_set" >                                    <button class="btn" id="add_product_for_set"><h3 class=""><i class="icon ion-plus"></i></h3></button>                                </div>                                <div class="clearfix"></div>                            </div>                            <div class="form-group col-sm-12">                                <div class='row'>                                <div id="products_set_list_view" >                                </div>                                                    </div>                            </div>                        <div class="form-group" style="text-align: center; position: relative;float:left;width:100%;">                            <input type="hidden" name="product_set_action" value="create_product_set" />                            <input type="submit" class="button product_upload" value="Create Set" />                            <i class="fa fa-cog fa-spin createsetfilterloader" style="color: #eb0d7d;  display: none;"></i>                            <!--<i class="fa fa-cog fa-spin update_product_loader"></i>-->                        </div>                        </form>                        </div>                </div            </div>          </div>        <?php        }        }        ?>        </script>        <?php        echo ob_get_clean();    }        public function add_merchant_set_products_ajax() {        $response = "";        $product_id = $_GET['product_id'];        if(!empty($product_id)){		            $response .='<div class="added_product_into_set col-sm-4 col-xs-12" product_id="'.$product_id.'"><span aria-hidden="true" class="delete_product_set" ><i class="icon ion-close"></i></span><div class="product_thumbnails">'.get_the_post_thumbnail($product_id).'</div>';            $response .= '<h3>'.get_the_title($product_id).'</h3><input type="hidden" name="product[]" value="'.$product_id.'"></div>';        }//        print_r($response);    exit();        echo json_encode(array('response'=>$response, 'product_id'=>$product_id));        die(0);    }   public function create_set_product_call_ajax() {        global $wpdb;        $form_values = $_POST['form_values'];        parse_str($form_values, $form);             if(!empty($form)) {            $success = "";            $error = "";            $state = "success";            $error_flag = false;            $user_id = $form['user_id'];             $set_name = $form['set_name'];             $select_product = $form['select_product_set'];             $product_ids = $form['product'];            //print_r($product_ids);             if(!empty($product_ids)){            $product_ids =  implode(',', $product_ids);            }            $form_action = $form['product_set_action'];             if($set_name=="") {                $error .= "<li>Please Enter Set name</li>";                $error_flag = true;                 $state = "error";            }            if($error_flag == false){//                print_r($product_ids); exit;              $indrty = $wpdb->insert('wp_product_set', array(                'user_id' => $user_id,                'set_name' => $set_name,                'pro_id' => $product_ids            ));                 $state = "success";                $success = "<li>Product Set Created Successfully !!!</li>";            }        }         echo json_encode(array('state'=>$state, 'error'=>$error, 'success'=>$success, 'form_action'=>$form_action));        die(0);    }    public function created_set_details_call_ajax() {       global $wpdb;       $products ="";        $merchant_user = wp_get_current_user();        $user_id = $merchant_user->ID;        $results = $wpdb->get_results( 'SELECT * FROM wp_product_set where user_id='.$user_id, OBJECT );//        print_r($results);        foreach ($results as $result) {          $products .= '<div class="product_sets_info" set-id="'.$result->id.'"><label style="font-size:12px;" for="">' . $result->set_name. '</label>';           $products .='<button class="btn btn-danger btn-sm product_set_delete" data-set-id="'.$result->id.'" >Delete</button><i class="fa fa-cog fa-spin deletefilterloader" style="color: #eb0d7d; margin-left: 5px; display: none;"></i>';          $products .='<button class="btn btn-primary btn-sm product_set_edit" data-set-id="'.$result->id.'" >Edit</button><i class="fa fa-cog fa-spin setfilterloader" style="color: #eb0d7d; margin-left: 5px; display: none;"></i>';          $products .='</div>';        }//        print_r($products);//        exit;        echo json_encode(array('response'=>$products));        die(0);    }     public function edited_set_details_call_ajax() {        $set_id = $_POST['set_id'];        global $wpdb;        $merchant_user = wp_get_current_user();        $user_id = $merchant_user->ID;        $results = $wpdb->get_row( 'SELECT * FROM wp_product_set where id='.$set_id, OBJECT );//        print_r($results); exit;                $response ='<div class="container" style="">                        <h3 class="page-header"><i class="icon ion-compose"></i>Edit Set</h3>                        </div>                        <form action="" method="post" class="edit_product_set_from">                            <div class="form-group col-sm-12">                                   <input type="hidden" name="user_id" value="'.$merchant_user->ID.'">                                <label for="product_title" class="label_input">Product Set Name<span class="required"></span>:</label>                                <div class="label_input"><input type="text" class="form-control" name="set_name" id="set_name" value="'.$results->set_name.'" /></div>                                <div class="clearfix"></div>                            </div>                            <div class="form-group col-sm-6 col-xs-12">                                <label for="select_product_set" class="label_input">Select Products:<span class="required"> * </span>:</label>                                <div class="label_input">';                                                                $args = array( 'post_type' => 'product', 'posts_per_page' => -1,'post_status' =>'publish','author' => $merchant_user->ID );                                $posts_array = get_posts( $args );//                                                               if ( $posts_array ) {//                                $myterms = get_terms('metal', array('hide_empty'=>false));                                    $response .='<select class="form-control" name="select_product_set" id="select_product_set">';                                    $response .='<option value="">Please Select Product</option>';                                    foreach($posts_array as $product){                                        $term_slug=$product->ID;                                        $term_name =$product->post_title ;                                        $response .= '<option value="'.$term_slug.'">'.$term_name.'</option>';                                    }                                $response .='</select>';                                  }                                $response .='</div><div class="clearfix"></div></div>                            <div class="form-group">                                <div class="select_product_for_set" >                                    <button class="btn" id="add_product_for_set"><h3 class=""><i class="icon ion-plus"></i></h3></button>                                </div>                                <div class="clearfix"></div>                            </div>                            <div class="form-group col-sm-12">                                <div class="row">                                <div id="products_set_list_view" >';                             if(!empty($results)){                                    $product_ids = explode(',', $results->pro_id);                                    foreach ($product_ids as $product_id) {                                       $post_object = get_post($product_id); //                                        print_r($post_object->post_title); exit;                                         $response .=' <div class="added_product_into_set col-sm-4 col-xs-12" product_id="'.$post_object->ID.'"><span aria-hidden="true" class="delete_product_set"><i class="icon ion-close"></i></span><div class="product_thumbnails">'.get_the_post_thumbnail($post_object->ID).'</div><h3>'.$post_object->post_title.'</h3><input type="hidden" name="product[]" value="'.$post_object->ID.'"></div>';                                    }                                }                                   $response .='</div>                                                    </div>                            </div>                            <div class="form-group" style="text-align: center; position: relative;float:left;width:100%;">                                <input type="hidden" name="product_set_id" value="'.$results->id.'" />                                <input type="submit" class="button product_upload" value="Update Set" />                                <i class="fa fa-cog fa-spin editsetfilterloader" style="color: #eb0d7d; display: none;"></i>                            </div>                        </form>';        echo json_encode(array('response'=>$response));        die(0);    }      public function edit_set_product_call_ajax() {        global $wpdb;        $form_values = $_POST['form_values'];        parse_str($form_values, $form);//        print_r($form); exit();        if(!empty($form)) {            $success = "";            $error = "";            $state = "success";            $error_flag = false;            $user_id = $form['user_id'];             $set_name = $form['set_name'];             $select_product = $form['select_product_set'];             $product_ids = $form['product'];            $id = $form['product_set_id'];            //print_r($product_ids);             if(!empty($product_ids)){            $product_ids =  implode(',', $product_ids);            }            $form_action = $form['product_set_action'];             if($set_name=="") {                $error .= "<li>Please Enter Set name</li>";                $error_flag = true;                 $state = "error";            }            if($error_flag == false){//                print_r($product_ids); exit;//                $indrty = $wpdb->insert('wp_product_set', array(//                'user_id' => $user_id,//                'set_name' => $set_name,//                'pro_id' => $product_ids//            ));                  $wpdb->update('wp_product_set', array('id'=>$id, 'user_id'=>$user_id, 'set_name'=>$set_name, 'pro_id'=>$product_ids), array('id'=>$id));               $state = "success";                $success = "<li>Product Set Updated Successfully !!!</li>";            }        }         echo json_encode(array('state'=>$state, 'error'=>$error, 'success'=>$success, 'form_action'=>$form_action));        die(0);    }    public function delete_set_product_call_ajax() {        global $wpdb;        $set_id = $_GET['set_id'];            $success = "";            $error = "";            $state = "success";            $error_flag = false;//        print_r($form_values); exit();                             if($error_flag == false){                //$wpdb->update('wp_product_set', array('id'=>$id, 'user_id'=>$user_id, 'set_name'=>$set_name, 'pro_id'=>$product_ids), array('id'=>$id));                $wpdb->delete( 'wp_product_set', array( 'id'=>$set_id, ) );               $state = "success";                $success = "<li>Product Set Deleted Successfully !!!</li>";            }                echo json_encode(array('state'=>$state, 'error'=>$error, 'success'=>$success, 'set_id'=>$set_id));        die(0);    }  }$GLOBALS['managesetobject'] = new ManageSetList();